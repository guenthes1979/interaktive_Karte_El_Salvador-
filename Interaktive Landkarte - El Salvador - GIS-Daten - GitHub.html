<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>El Salvador ‚Äì Karte</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <style>
    html, body { height: 100%; margin: 0; }
    #map { width: 100%; height: 100%; }
	
	/* Falls irgendein CSS Leaflet Controls versteckt */
	.leaflet-top, .leaflet-bottom { z-index: 999999 !important; }
	.leaflet-control { display: block !important; }
	
	
	.photo-marker {
    border-radius:50%;
    border:3px solid white;
    box-shadow:0 2px 10px rgba(0,0,0,.35);
    display:block;
  }
	
	.river-label{
  font-size:10px;
  font-weight:700;
  color:#2b6cb0; /* blau */
  text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
  white-space:nowrap;
  pointer-events:none;
}
.river-label.main{
  font-size:12px;
  color:#1f6feb; /* kr√§ftigeres Blau f√ºr Lempa */
}

  .popup-img {
    width:220px;
    max-width:100%;
    border-radius:10px;
    margin-top:8px;
    display:block;
  }
}


  </style>
</head>

<body>
  <!-- WICHTIG: Muss VOR dem Script stehen -->
  <div id="map"></div>

  <script>
    // ================= KARTE =================
    const map = L.map("map");
    map.fitBounds([[13.0, -90.2], [14.5, -87.6]]);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "¬© OpenStreetMap",
      maxZoom: 19
    }).addTo(map);
	
	// ================= LAYER-GRUPPEN =================
	const layerStaedte = L.layerGroup().addTo(map);
	const layerSehensw = L.layerGroup().addTo(map);
	const layerNatur   = L.layerGroup().addTo(map);
	const layerOrte    = L.layerGroup().addTo(map);
	const layerFlues


    // ================= LEGENDE =================
    const legend = L.control({ position: "topright" });
    legend.onAdd = function () {
      const div = L.DomUtil.create("div");
      div.style.background = "white";
      div.style.padding = "10px";
      div.style.borderRadius = "10px";
      div.style.boxShadow = "0 2px 8px rgba(0,0,0,.2)";
      div.style.fontSize = "13px";
      div.style.lineHeight = "1.35";
      div.style.maxWidth = "220px";
      div.style.zIndex = "99999";
      div.innerHTML = `
        <b>Legende</b><br>
        üèôÔ∏è St√§dte<br>
        üèõÔ∏è Sehensw√ºrdigkeiten<br>
        üåø Natur / Parks / Vulkane<br>
        üèñÔ∏è Str√§nde<br>
        ‚ùó Besondere Orte<br>
        <hr style="border:none;border-top:1px solid #eee;margin:8px 0;">
        <span style="border-top:3px solid #1f6feb;display:inline-block;width:30px"></span> Hauptfluss<br>
        <span style="border-top:2px solid #6ea8ff;display:inline-block;width:30px"></span> Weitere Fl√ºsse
      `;
      return div;
    };
    legend.addTo(map);

	// ‚úÖ erzwinge Sichtbarkeit (falls CSS sie versteckt)
	const c = legend.getContainer();
	c.style.display = "block";
	c.style.zIndex = "999999";

// ================= FL√úSSE (Top 5 + 1 Label je Fluss) =================
const layerFluesse = L.layerGroup().addTo(map);

// 5 wichtigste Fl√ºsse
const KEEP_RIVERS = new Set([
  "R√≠o Lempa",
  "R√≠o Paz",
  "R√≠o Goascor√°n",
  "R√≠o Grande de San Miguel",
  "R√≠o Jiboa"
]);

// falls Namen ohne Akzent in den Daten vorkommen
const KEEP_RIVERS_ALT = new Set([
  "Rio Lempa",
  "Rio Paz",
  "Rio Goascoran",
  "Rio Grande de San Miguel",
  "Rio Jiboa"
]);

// Nur 1 Label pro Flussname
const labeled = new Set();

// Label-Versatz (dx = rechts/links, dy = hoch/runter)
function labelOffset(name) {
  if (!name) return [0, 0];
  const n = name.toLowerCase();
  // Lempa-Label etwas nach rechts & leicht nach oben verschieben:
  if (n.includes("lempa")) return [0.35, -0.15]; // <- bei Bedarf feinjustieren
  return [0, 0];
}

function normName(s) {
  return (s || "").trim();
}

// GitHub Pages-sicher (Cache umgehen)
fetch(new URL("data/rivers.geojson", document.baseURI), { cache: "no-store" })
  .then(r => {
    if (!r.ok) throw new Error("HTTP " + r.status);
    return r.json();
  })
  .then(geo => {
    const features = (geo.features || []).filter(f => {
      const name = normName(f.properties?.name);
      return KEEP_RIVERS.has(name) || KEEP_RIVERS_ALT.has(name);
    });

    const filtered = { type: "FeatureCollection", features };

    // Flusslinien zeichnen
    L.geoJSON(filtered, {
      style: (feature) => {
        const name = (feature.properties?.name || "").toLowerCase();
        const isLempa = name.includes("lempa");
        return {
          color: isLempa ? "#1f6feb" : "#6ea8ff",
          weight: isLempa ? 2.6 : 1.3,
          opacity: 0.92
        };
      },

      onEachFeature: (feature, layer) => {
        const name = feature.properties?.name;
        if (!name) return;

        // optionales Popup
        layer.bindPopup(`<b>${name}</b>`);

        // nur 1 Beschriftung je Name
        if (labeled.has(name)) return;
        labeled.add(name);

        // Position: Mittelpunkt des Bounds
        const center = layer.getBounds().getCenter();
        const [dx, dy] = labelOffset(name);
        const pos = L.latLng(center.lat + dy, center.lng + dx);

        // Label als DivIcon
        L.marker(pos, {
          interactive: false,
          icon: L.divIcon({
            className: name.toLowerCase().includes("lempa") ? "river-label main" : "river-label",
            html: name,
            iconSize: null
          })
        }).addTo(layerFluesse);
      }
    }).addTo(layerFluesse);
  })
  .catch(err => {
    alert("‚ùå Fl√ºsse konnten nicht geladen werden: " + err.message);
  });

 // ================= LAYER =================
  const layerStaedte = L.layerGroup().addTo(map);
  const layerKultur = L.layerGroup().addTo(map);
  const layerNatur = L.layerGroup().addTo(map);
  const layerStrand = L.layerGroup().addTo(map);
  const layerWeitereBesondereOrte = L.layerGroup().addTo(map);
  const layerBesondereOrte = L.layerGroup().addTo(map);
  const layerHauptfluesse = L.layerGroup().addTo(map);
  const layerNebenfluesse = L.layerGroup().addTo(map);


  // ================= ICONS =================
  // Bildmarker mit optionaler optischer Verschiebung (dx, dy) in Pixeln
  function makeImageDivIcon(imageUrl, size = 46, dx = 0, dy = 0) {
    return L.divIcon({
      className:"",
      html: `
        <img src="${imageUrl}" class="photo-marker"
             style="width:${size}px;height:${size}px;transform:translate(${dx}px,${dy}px)">
      `,
      iconSize:[size,size],
      iconAnchor:[size/2,size],   // unten mittig
      popupAnchor:[0,-size]
    });
  }

  // Einfache Emoji-Marker als Fallback (f√ºr Natur/Besondere Orte, falls du willst)
  function makeEmojiIcon(emoji, bg) {
    return L.divIcon({
      className:"",
      html: `
        <div style="
          width:28px;height:28px;border-radius:999px;background:${bg};
          display:flex;align-items:center;justify-content:center;
          border:2px solid white;box-shadow:0 2px 8px rgba(0,0,0,.25);
          font-size:16px;">
          ${emoji}
        </div>`,
      iconSize:[28,28],
      iconAnchor:[14,28],
      popupAnchor:[0,-28]
    });
  }

  const iconNature = makeEmojiIcon("üåø", "#73d99f");
  const iconAlert  = makeEmojiIcon("‚ùó", "#ffd166");

  // ================= POPUP =================
  function popupHTML(o){
    const img = o.imgUrl ? `<img class="popup-img" src="${o.imgUrl}" alt="${o.title}">` : "";
    return `
      <div>
        <b>${o.title}</b><br>
        <i>${o.subtitle || ""}</i><br><br>
        ${o.text || ""}
        ${img}
      </div>
    `;
  }

  // ================= DATEN =================
  const staedte = [
    {
      title:"San Salvador",
      coords:[13.6929,-89.2182],
      iconLocal:"images/San Salvador.jpg",
      subtitle:"Hauptstadt",
      text:"San Salvador ist die Hauptstadt von El Salvador ‚Äì Zentrum f√ºr Politik, Bildung und Wirtschaft.",
      imgUrl:"https://cdn.getyourguide.com/img/tour/47988c7e5b8bbf0af11e62a6ff4aefeea5a7f6de61e1c3bbe1389006ef589164.jpg/98.jpg"
    },
    {
      title:"Santa Ana",
      coords:[13.9942,-89.5597],
      iconLocal:"images/Santa Ana.jpg",
      subtitle:"Stadt im Westen",
      text:"Santa Ana ist eine wichtige Stadt im Westen. In der N√§he liegt eine Vulkanregion.",
      imgUrl:"https://www.my-travelworld.de/wp-content/uploads/el_salvador_006_santa_ana_parque_la_libertad.jpg"
    },
    {
      title:"San Miguel",
      coords:[13.4833,-88.1833],
      iconLocal:"images/San Miguel.jpg",
      subtitle:"Stadt im Osten",
      text:"San Miguel ist eine gro√üe Stadt im Osten und ein Zentrum f√ºr Handel und Regionalkultur.",
      imgUrl:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRVnidkF5P_hi1khBDr9juprQ6LYOqGPTcNsw&s"
    }
  ];

  const kultur = [
    {
      title:"Joya de Cer√©n (UNESCO)",
      coords:[13.8267,-89.3611],
      iconLocal:"images/Joya de Ceren.jpg",
      subtitle:"Arch√§ologische Fundst√§tte",
      text:"Ein Dorf, das durch Vulkanasche erhalten blieb ‚Äì ein einzigartiger Blick in die Vergangenheit.",
      imgUrl:"https://dynamic-media-cdn.tripadvisor.com/media/photo-o/04/79/d3/d3/sitio-arqueologico-joya.jpg?w=900&h=500&s=1"
    },
    {
      title:"Tazumal (Chalchuapa)",
      coords:[13.9867,-89.6817],
      iconLocal:"images/Tazumal.jpg",
      subtitle:"Ruinenanlage",
      text:"Bekannte Ruinenst√§tte ‚Äì zeigt fr√ºhe gro√üe Siedlungen und Kultur in der Region.",
      imgUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/9b/ES_Tazumal_06_2011_2236.jpg/1200px-ES_Tazumal_06_2011_2236.jpg"
    },
    {
      title:"Ruta de las Flores (Region)",
      coords:[13.8480,-89.6620],
      iconLocal:"images/Ruta de las Flores.jpg",
      subtitle:"Kulturroute im Hochland",
      text:"Region/Route mit D√∂rfern, M√§rkten, Kaffee und sch√∂ner Berglandschaft.",
      imgUrl:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ1T1fDFVIwvvMToRqZWqtLqJJysKt6JfLFWg&s",
      dx:-35, dy:-10 // ‚¨ÖÔ∏è nach links verschoben
    }
  ];

  const natur = [
    {
      title:"Lago de Coatepeque",
      coords:[13.8630,-89.5480],
      iconLocal:"images/Lago de Coatepeque.jpg",
      subtitle:"Vulkanischer Kratersee",
      text:"Gro√üer Kratersee ‚Äì durch vulkanische Prozesse entstanden und landschaftlich sehr beeindruckend.",
      imgUrl:"https://upload.wikimedia.org/wikipedia/commons/d/d0/Teopan.jpg",
      dx:12, dy:24   // ‚û°Ô∏è‚¨áÔ∏è nach rechts & unten verschoben
    }
  ];

  const besondereOrte = [
  {
    title:"Erdbeben- & Vulkanzone",
    coords:[13.9000,-88.9000],
    subtitle:"Naturgefahren",
    text:"El Salvador liegt an einer Plattengrenze ‚Äì daher gibt es h√§ufig Erdbeben und Vulkane.",
    iconLocal:"images/Vulkan San Vincente.jpg",      
    imgUrl:"https://images.trvl-media.com/localexpert/46416047/bb24d270-a348-48af-b3a9-d5262657acd1.jpg?impolicy=resizecrop&rw=1005&rh=565"
  }
];

const weitereBesondereOrte = [
{
    title: "Vulkan Izalco",
    coords: [13.8136, -89.6333],
    subtitle: "Junger Vulkan",
    text: "Der Vulkan Izalco entstand im 18. Jahrhundert und war wegen seiner h√§ufigen Ausbr√ºche als ‚ÄûLeuchtturm des Pazifiks‚Äú bekannt.",
    iconLocal: "images/Vulkan Izalco.jpg",
    imgUrl: "https://volcanodiscovery.de/uploads/tx_volcanoes/izalco.JPG",
    dx: -25,   // ‚¨ÖÔ∏è nach links (gegen √úberlappung mit Santa Ana/Cerro Verde)
    dy: 20   // ‚¨áÔ∏è leicht nach unten 
  },
  {
    title: "Bah√≠a de Jiquilisco",
    coords: [13.2000, -88.5000],
    subtitle: "Mangroven & Biosph√§renreservat",
    text: "Gro√ües Mangrovengebiet an der Pazifikk√ºste. Wichtig f√ºr Fischerei, K√ºstenschutz und viele Tierarten.",
    iconLocal: "images/Bah√≠a de Jiquilisco.jpg",
    imgUrl: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRKgQxZbWrEySf-WcA_7V065vetmCwzWdMJlw&s",
    dx: 10,    // ‚û°Ô∏è leicht nach rechts (optional)
    dy: 10     // ‚¨áÔ∏è leicht nach unten (optional)
  },
  {
    title: "Nationalpark Montecristo",
    coords: [14.3906, -89.3847],
    subtitle: "Nebelwald & Dreil√§ndereck",
    text: "Feuchter Nebelwald im Grenzgebiet zu Guatemala und Honduras mit seltener Pflanzen- und Tierwelt.",
    iconLocal: "images/Nationalpark Montecristo.jpg",
    imgUrl: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSE1t5eWuOSxOBazaAYFaxvF51DISrBACIQ7Q&s",
    dx: -10,   // ‚¨ÖÔ∏è leicht nach links (optional)
    dy: 12     // ‚¨áÔ∏è leicht nach unten (optional)
  }
];


  
  // ================= STRAND =================
const straende = [
  {
    title:"El Tunco",
    coords:[13.4927,-89.3816],
    iconLocal:"images/El Tunca - Strand.jpg",
    subtitle:"Pazifikstrand",
    text:"El Tunco ist ein bekannter Surfstrand mit schwarzem Vulkansand und markantem Felsen im Meer.",
    imgUrl:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQj7nvMHqZyRQlgWTBUcFkuquRMN6vswgvBGA&s"
  },
  {
    title: "Costa del Sol",
    coords: [13.3450, -88.9300],
    subtitle: "Langer Sandstrand",
    text: "Beliebter Strand an der Pazifikk√ºste mit Tourismus, Fischerei und Lagunenlandschaft.",
    iconLocal: "images/Costa del Sol.jpg",
    imgUrl: "https://daytrip.imgix.net/Playa-Costa-del-Sol.jpg",
    dx: 14,    // ‚û°Ô∏è etwas nach rechts (optional)
    dy: 0
  }
];

// ================= VULKANE =================
const vulkane = [
  {
    title:"Vulkan Santa Ana (Ilamatepec)",
    coords:[13.8536,-89.6300],
    iconLocal:"images/Vulkan Santa Ana.jpg",
    subtitle:"H√∂chster Vulkan des Landes",
    text:"Der Vulkan Santa Ana ist der h√∂chste Vulkan El Salvadors und besitzt einen Kratersee.",
    imgUrl:"https://betterbeyond.de/wp-content/uploads/2022/03/Santa-Ana-Volcano.jpg",
	dx:10, dy:0  // ‚û°Ô∏è‚¨áÔ∏è nach rechts & unten verschoben
  },
  {
    title:"Vulkan San Miguel (Chaparrastique)",
    coords:[13.4347,-88.2694],
    iconLocal:"images/Vulkan San Miguel.jpg",
    subtitle:"Aktiver Vulkan im Osten",
    text:"Einer der aktivsten Vulkane El Salvadors mit regelm√§√üigen Ausbr√ºchen.",
    imgUrl:"https://media.tacdn.com/media/attractions-splice-spp-674x446/0d/09/83/01.jpg"
  }
];

// ================= NATIONALPARKS =================
const nationalparks = [
  {
    title:"Nationalpark Cerro Verde",
    coords:[13.8239,-89.6256],
    iconLocal:"images/Cerro Verde.jpg",
    subtitle:"Vulkanlandschaft",
    text:"Der Nationalpark Cerro Verde bietet Ausblicke auf mehrere Vulkane und Wanderwege.",
    imgUrl:"https://cf.bstatic.com/xdata/images/hotel/max1024x768/318491098.webp?k=b2067e419d9e605e0c0d266455e9d5b1e3b654cad1001af8066ec704d45ae0ae&o=",
	dx:30, dy:20   // ‚û°Ô∏è‚¨áÔ∏è nach rechts & unten verschoben
  },
  {
    title:"Nationalpark El Imposible",
    coords:[13.8375,-89.9397],
    iconLocal:"images/El Imposible Nationalpark.jpg",
    subtitle:"Regenwald & Tierwelt",
    text:"Der gr√∂√üte Nationalpark El Salvadors mit tropischem Regenwald und vielen Tierarten.",
    imgUrl:"https://thumbs.dreamstime.com/b/wasserfall-nationalpark-el-imposible-honduras-110551462.jpg"
  }
];

function labelOffset(name){
  if (!name) return [0, 0];

  // Spezielle Anpassung f√ºr Lempa
  if (name.toLowerCase().includes("lempa")) {
    return [0.4, -0.2]; // ‚ûú nach Osten & etwas nach Norden
  }

  return [0, 0];
}

// ================= MARKER ERZEUGEN =================
  staedte.forEach(o => {
    L.marker(o.coords, { icon: makeImageDivIcon(o.iconLocal, 46, o.dx||0, o.dy||0) })
      .addTo(layerStaedte)
      .bindPopup(popupHTML(o));
  });

  kultur.forEach(o => {
    L.marker(o.coords, { icon: makeImageDivIcon(o.iconLocal, 46, o.dx||0, o.dy||0) })
      .addTo(layerKultur)
      .bindPopup(popupHTML(o));
  });

  natur.forEach(o => {
    // Natur auch als Bildmarker (hier speziell Lago)
    L.marker(o.coords, { icon: makeImageDivIcon(o.iconLocal, 46, o.dx||0, o.dy||0) })
      .addTo(layerNatur)
      .bindPopup(popupHTML(o));
  });

  besondereOrte.forEach(o => {
  const icon = o.iconLocal
    ? makeImageDivIcon(o.iconLocal, 46, o.dx||0, o.dy||0)
    : iconAlert;

  L.marker(o.coords, { icon })
    .addTo(layerBesondereOrte)
    .bindPopup(popupHTML(o));
});
weitereBesondereOrte.forEach(o => {
  L.marker(o.coords, {
    icon: makeImageDivIcon(o.iconLocal, 46, o.dx || 0, o.dy || 0)
  })
  .addTo(layerBesondereOrte)
  .bindPopup(popupHTML(o));
});

  
  // ================= STRAND-MARKER =================
straende.forEach(o => {
  L.marker(o.coords, {
    icon: makeImageDivIcon(o.iconLocal, 46, 0, 0)
  }).addTo(layerStrand).bindPopup(popupHTML(o));
});

// ================= VULKAN-MARKER =================
vulkane.forEach(o => {
  L.marker(o.coords, {
    icon: makeImageDivIcon(o.iconLocal, 46, 0, 0)
  }).addTo(layerNatur).bindPopup(popupHTML(o));
});

// ================= NATIONALPARK-MARKER =================
nationalparks.forEach(o => {
  const dy = (o.title === "Nationalpark Cerro Verde") ? 25 : 0;

  L.marker(o.coords, {
    icon: makeImageDivIcon(o.iconLocal, 46, 0, dy)
  }).addTo(layerNatur).bindPopup(popupHTML(o));
});

// ================= HAUPTFL√úSSE =================
hauptfluesse.forEach(fluss => {
  L.polyline(fluss.coords, {
    color: "#1f6feb",
    weight: 3,        // etwas dicker
    opacity: 0.9
  })
  .addTo(layerHauptfluesse)
  .bindPopup(`<b>${fluss.name}</b><br>${fluss.text}`);
});

// ================= NEBENFL√úSSE =================
nebenfluesse.forEach(fluss => {
  L.polyline(fluss.coords, {
    color: "#6ea8ff",
    weight: 1.5,      // d√ºnner
    opacity: 0.8,
    dashArray: "4,4"
  })
  .addTo(layerNebenfluesse)
  .bindPopup(`<b>${fluss.name}</b><br>${fluss.text}`);
});


  // ================= LAYER CONTROL =================
  L.control.layers(null, {
  "üèôÔ∏è St√§dte": layerStaedte,
  "üèõÔ∏è Sehensw√ºrdigkeiten": layerKultur,
  "üåø Natur": layerNatur,
  "üèñÔ∏è Strand": layerStrand,
  "üü¶ Fl√ºsse (Auswahl)": layerFluesse
}, { collapsed: false }).addTo(map);



  </script>
</body>
</html>